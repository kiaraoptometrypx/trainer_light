<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Fan Chart with Fogging & CYL Blur (iPad Compatible)</title>
<style>
  #fan-container {
    width: 400px;
    height: 400px;
    margin: 20px auto;
    transform-origin: center center;
  }
  .fan-line { stroke:black; stroke-width:4; stroke-linecap:round; }
  .axis-label { font-size:12px; fill:black; font-family:Arial; }
  .controls { text-align:center; margin-top:10px; font-family:Arial; }
  button { font-size:16px; margin:0 5px; padding:5px 10px; }
  #cylVal { font-weight:bold; margin-left:10px; }
</style>
</head>
<body>

<div class="controls">
  CYL Blur:
  <button onclick="changeCyl(-0.25)">−</button>
  <button onclick="changeCyl(0.25)">+</button>
  <span>Current: <span id="cylVal">0.00</span></span>
</div>

<div class="controls">
  Fog:
  <button id="fogBtn" onclick="toggleFogging()">Fog 1.00</button>
</div>

<div class="controls">
  Rotate:
  <button id="minusBtn">−5°</button>
  <span id="angleVal">0</span>°
  <button id="plusBtn">+5°</button>
</div>

<div id="fan-container">
  <svg width="400" height="400" viewBox="0 0 400 400">
    <defs id="filters">
      <!-- Filters will be generated dynamically -->
    </defs>

    <g id="fan-group" transform="translate(200 200)"></g>

    <!-- White circle on top -->
    <circle cx="200" cy="200" r="50" fill="white"/>

    <!-- Axis labels flipped -->
    <g transform="rotate(180 185 15)"><text class="axis-label" x="0" y="0">180°</text></g>
    <g transform="rotate(180 370 205)"><text class="axis-label" x="0" y="0">90°</text></g>
    <g transform="rotate(180 185 395)"><text class="axis-label" x="0" y="0">0°</text></g>
    <g transform="rotate(180 5 205)"><text class="axis-label" x="0" y="0">90°</text></g>
  </svg>
</div>

<script>
let angle = 0;
let cylBlur = 0.00;       // CYL blur
let foggingBlur = 1.00;   // Fog starts ON
let fogOn = true;

const fanGroup = document.getElementById('fan-group');
const filters = document.getElementById('filters');
const angleVal = document.getElementById('angleVal');
const cylVal = document.getElementById('cylVal');
const fogBtn = document.getElementById('fogBtn');

// Initial fog button color
fogBtn.style.backgroundColor = 'lightblue';

// Rotation buttons
document.getElementById('plusBtn').addEventListener('click', () => { if(angle<180){ angle+=5; updateRotation(); }});
document.getElementById('minusBtn').addEventListener('click', () => { if(angle>0){ angle-=5; updateRotation(); }});
function updateRotation() {
  fanGroup.setAttribute('transform', `translate(200 200) rotate(${angle})`);
  angleVal.textContent = angle;
}

// CYL blur buttons
function changeCyl(delta) {
  cylBlur = Math.max(0, +(cylBlur + delta).toFixed(2));
  cylVal.textContent = cylBlur.toFixed(2);
  drawFan();
}

// Toggle fog
function toggleFogging() {
  fogOn = !fogOn;
  foggingBlur = fogOn ? 1.00 : 0.00;
  fogBtn.style.backgroundColor = fogOn ? 'lightblue' : '';
  drawFan();
}

// Create or update a filter for given blur amount
function createFilter(id, blurVal) {
  let existing = document.getElementById(id);
  if(existing) { existing.querySelector('feGaussianBlur').setAttribute('stdDeviation', blurVal); return; }

  const filter = document.createElementNS("http://www.w3.org/2000/svg","filter");
  filter.setAttribute("id", id);
  filter.setAttribute("x", "-50%");
  filter.setAttribute("y", "-50%");
  filter.setAttribute("width", "200%");
  filter.setAttribute("height", "200%");
  const blur = document.createElementNS("http://www.w3.org/2000/svg","feGaussianBlur");
  blur.setAttribute("in","SourceGraphic");
  blur.setAttribute("stdDeviation", blurVal);
  filter.appendChild(blur);
  filters.appendChild(filter);
}

// Draw fan
function drawFan() {
  fanGroup.innerHTML = '';
  const angles = [0,15,30,45,60,75,90,105,120,135,150,165];

  angles.forEach((a,i) => {
    const dist = Math.min(Math.abs(a-0), Math.abs(a-180));
    const blurVal = +(dist/15 * cylBlur + foggingBlur).toFixed(2);
    const filterId = `blur${i}`;
    createFilter(filterId, blurVal);

    const line = document.createElementNS("http://www.w3.org/2000/svg","line");
    line.setAttribute("class","fan-line");
    line.setAttribute("x1","0");
    line.setAttribute("y1","-180");
    line.setAttribute("x2","0");
    line.setAttribute("y2","180");
    line.setAttribute("transform", `rotate(${a})`);
    line.setAttribute("filter", `url(#${filterId})`);

    fanGroup.appendChild(line);
  });
}

// Initial draw
updateRotation();
drawFan();
</script>

</body>
</html>
