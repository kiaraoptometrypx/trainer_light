<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Fan Chart with Fogging & CYL Blur (Side Buttons with Header)</title>
<style>
  body {
    display: flex;
    flex-direction: column;
    align-items: center;
    margin: 0;
    font-family: Arial;
    height: 100vh;
    justify-content: center;
  }

  #header {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 20px;
    margin-bottom: 10px;
  }

  #container {
    display: flex;
    align-items: center;
  }

  #left-controls, #right-controls {
    display: flex;
    flex-direction: column;
    gap: 20px;
  }

  #right-controls { margin-left: 20px; }
  #left-controls { margin-right: 20px; }

  button { font-size:16px; padding:5px 10px; }
  #cylVal { font-weight:bold; margin-left:5px; }

  canvas {
    border: 1px solid #ccc;
    background: #fff;
  }
</style>
</head>
<body>

<!-- Header with Fog and Current CYL -->
<div id="header">
  <div>
    Current CYL: <span id="cylVal">0.00</span>
  </div>
  <div>
    Fog:
    <button id="fogBtn" onclick="toggleFogging()">Fog 1.00 (ON)</button>
  </div>
</div>

<div id="container">
  <!-- Left side buttons -->
  <div id="left-controls">
    <div>
      CYL −
      <button onclick="changeCyl(-0.25)">−</button>
    </div>
    <div>
      Rotate −5°
      <button onclick="rotateFan(-5)">−5°</button>
    </div>
  </div>

  <!-- Canvas -->
  <canvas id="fan-container" width="400" height="400"></canvas>

  <!-- Right side buttons -->
  <div id="right-controls">
    <div>
      CYL + 
      <button onclick="changeCyl(0.25)">+</button>
    </div>
    <div>
      Rotate +5°
      <button onclick="rotateFan(5)">+5°</button>
    </div>
  </div>
</div>

<script>
const canvas = document.getElementById('fan-container');
const ctx = canvas.getContext('2d');

let cylBlur = 0.00;
let fogOn = true;
let fogStrength = 1.00;
let angle = 0;

const cylVal = document.getElementById('cylVal');
const fogBtn = document.getElementById('fogBtn');

cylVal.textContent = cylBlur.toFixed(2);

// Toggle fog
function toggleFogging() {
  fogOn = !fogOn;
  fogBtn.textContent = fogOn ? 'Fog 1.00 (ON)' : 'Fog 1.00 (OFF)';
  drawFan();
}

// Change CYL blur
function changeCyl(delta) {
  cylBlur = Math.max(0, +(cylBlur + delta).toFixed(2));
  cylVal.textContent = cylBlur.toFixed(2);
  drawFan();
}

// Rotate fan
function rotateFan(delta) {
  angle = (angle + delta + 360) % 360;
  drawFan();
}

// Draw fan using opacity stacking
function drawFan() {
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.save();
  ctx.translate(200,200);
  ctx.rotate(angle * Math.PI / 180);

  const angles = [0,15,30,45,60,75,90,105,120,135,150,165];

  angles.forEach(a => {
    const dist = Math.min(Math.abs(a-0), Math.abs(a-180));
    const totalBlur = dist/15 * cylBlur + (fogOn ? fogStrength : 0);
    const layers = Math.max(1, Math.round(totalBlur*3));

    for(let i=0; i<layers; i++){
      const offset = (i - layers/2) * 0.7;
      ctx.save();
      ctx.rotate(a * Math.PI / 180);
      ctx.lineWidth = 4;
      ctx.strokeStyle = 'rgba(0,0,0,'+(1/layers)+')';
      ctx.beginPath();
      ctx.moveTo(offset, -150);
      ctx.lineTo(offset, 150);
      ctx.stroke();
      ctx.restore();
    }
  });

  ctx.restore();

  // Center circle
  ctx.beginPath();
  ctx.arc(200,200,50,0,Math.PI*2);
  ctx.fillStyle = 'white';
  ctx.fill();

  // Axis labels upright
  ctx.fillStyle = 'black';
  ctx.font = '12px Arial';
  ctx.textAlign = 'center';
  ctx.textBaseline = 'middle';
  ctx.fillText('90°', 200, 20);
  ctx.fillText('90°', 200, 380);
  ctx.fillText('180°', 380, 200);
  ctx.fillText('0°', 20, 200);
}

// Initial draw
drawFan();
</script>

</body>
</html>
