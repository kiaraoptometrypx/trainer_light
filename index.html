<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Fan Chart with Fogging & CYL Blur</title>
<style>
  #fan-container {
    width: 400px;
    height: 400px;
    margin: 20px auto;
    transform-origin: center center;
  }
  .fan-line { stroke:black; stroke-width:4; stroke-linecap:round; }
  .axis-label { font-size:12px; fill:black; font-family:Arial; }
  .controls { text-align:center; margin-top:10px; font-family:Arial; }
  button { font-size:16px; margin:0 5px; padding:5px 10px; }
  #cylVal { font-weight:bold; margin-left:10px; }
</style>
</head>
<body>

<div class="controls">
  CYL Blur:
  <button onclick="changeCyl(-0.25)">−</button>
  <button onclick="changeCyl(0.25)">+</button>
  <span>Current: <span id="cylVal">0.00</span></span>
</div>

<div class="controls">
  Fog:
  <button id="fogBtn" onclick="toggleFogging()">Fog 1.00</button>
</div>

<div class="controls">
  Rotate:
  <button id="minusBtn">−5°</button>
  <span id="angleVal">0</span>°
  <button id="plusBtn">+5°</button>
</div>

<div id="fan-container">
  <svg width="400" height="400" viewBox="0 0 400 400">
    <g id="fan-group" transform="translate(200 200)">
      <!-- Lines generated dynamically -->
    </g>

    <!-- White circle on top -->
    <circle cx="200" cy="200" r="50" fill="white"/>

    <!-- Axis labels -->
    <text class="axis-label" x="185" y="15">180°</text>
    <text class="axis-label" x="370" y="205">90°</text>
    <text class="axis-label" x="185" y="395">0°</text>
    <text class="axis-label" x="5" y="205">90°</text>
  </svg>
</div>

<script>
let angle = 0;
let cylBlur = 0.00;       // CYL blur starts at 0
let foggingBlur = 1.00;   // Fog starts ON
let fogOn = true;          // fog toggle state

const fanGroup = document.getElementById('fan-group');
const angleVal = document.getElementById('angleVal');
const cylVal = document.getElementById('cylVal');
const fogBtn = document.getElementById('fogBtn');

// Set initial fog button color
fogBtn.style.backgroundColor = 'lightblue';

// Rotation buttons
document.getElementById('plusBtn').addEventListener('click', () => {
  if(angle < 180) { angle += 5; updateRotation(); }
});
document.getElementById('minusBtn').addEventListener('click', () => {
  if(angle > 0) { angle -= 5; updateRotation(); }
});
function updateRotation() {
  fanGroup.setAttribute('transform', `translate(200 200) rotate(${angle})`);
  angleVal.textContent = angle;
}

// CYL blur buttons
function changeCyl(delta) {
  cylBlur = Math.max(0, +(cylBlur + delta).toFixed(2)); // no negative
  cylVal.textContent = cylBlur.toFixed(2);
  drawFan();
}

// Toggle fogging
function toggleFogging() {
  if (!fogOn) {
    foggingBlur = 1.00;
    fogOn = true;
    fogBtn.style.backgroundColor = 'lightblue';
  } else {
    foggingBlur = 0;
    fogOn = false;
    fogBtn.style.backgroundColor = '';
  }
  drawFan();
}

// Draw fan
function drawFan() {
  fanGroup.innerHTML = '';
  const angles = [0,15,30,45,60,75,90,105,120,135,150,165];
  angles.forEach(a => {
    const line = document.createElementNS("http://www.w3.org/2000/svg","line");
    line.setAttribute("class","fan-line");
    line.setAttribute("x1","0");
    line.setAttribute("y1","-180");
    line.setAttribute("x2","0");
    line.setAttribute("y2","180");
    line.setAttribute("transform", `rotate(${a})`);

    // CYL blur (progressive)
    let dist = Math.min(Math.abs(a-0), Math.abs(a-180));
    let blurVal = (dist/15) * cylBlur;

    // Add fog if active
    blurVal += foggingBlur;

    line.style.filter = `blur(${blurVal}px)`;
    fanGroup.appendChild(line);
  });
}

// Initial draw
updateRotation();
drawFan();
</script>

</body>
</html>
