<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Fan Chart with Fogging & CYL Blur (Side Buttons with Header)</title>
<style>
  body {
    display: flex;
    flex-direction: column;
    align-items: center;
    margin: 0;
    font-family: Arial;
    font-size:15px;
    color:#404040;
    height: 100vh;
    justify-content: center;
    background: lightgrey;
  }

  #header {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 20px;
    margin-bottom: 10px;
  }

  #container {
    display: flex;
    align-items: center;
  }

  #left-controls, #right-controls {
    display: flex;
    flex-direction: column;
    gap: 20px;
  }

  #right-controls { margin-left: 20px; }
  #left-controls { margin-right: 20px; }

  #cylVal { font-weight:bold; margin-left:5px; }

canvas {
  background: #ebebeb;
  width: 100%;
  aspect-ratio: 1 / 1;
  padding:30px 30px 0 30px;
  border-radius:30%;
}



button  {
border:2px solid grey;
font-size:15px;
padding:2px;
height:50px;
width:100px;
border-radius:10px;
margin-top:5px;
margin-bottom:5px;
color:#404040;
}

.smallbtn {
border:2px solid grey;
font-size:15px;
padding:2px;
height:25px;
width:100px;
border-radius:10px;
margin-top:5px;
margin-bottom:5px;
color:#404040;

}

</style>
</head>
<body>

<!-- Header with Fog and Current CYL -->

<span><b>Adjust the rotation and line darkness to match what you see.</b></span>
<div style="margin-top:20px" id="header">
<span style="font-size:20px" ><b>CYL Value <span style="color:darkred" id="cylVal">0.00</span></b></span>
</div>




<div id="container">
  <!-- Left side buttons -->
  <div id="left-controls">
    <div>
      <b>Line</b><br>
      <button onclick="changeCyl(-0.25)"> Lighter </button>
    </div>
    <div>
      <b>Rotate</b><br>
      <button onclick="rotateFan(-90)"> <<< </button><br>
      <button onclick="rotateFan(-45)"> << </button><br>
      <button onclick="rotateFan(-15)"> < </button>

    </div>
  </div>

  <!-- Canvas -->
  <canvas style="margin-top:20px" id="fan-container" width="500" height="500"></canvas>

  <!-- Right side buttons -->
  <div id="right-controls">
    <div>
      <b>Line</b><br>
      <button onclick="changeCyl(0.25)"> Darker </button>
    </div>
    <div>
      <b>Rotate</b><br>
      <button onclick="rotateFan(90)"> >>> </button><br>
      <button onclick="rotateFan(45)"> >> </button><br>
      <button onclick="rotateFan(15)"> > </button>
    </div>
  </div>

</div>

<div style="height:20px"> </div>


<div id="header">
    <b>Change All lines </b>
    <button id="fogBtn" onclick="toggleFogging()">Lighter</button>
  </div>

<div style="height:40px"> </div>





<script>
const canvas = document.getElementById('fan-container');
const ctx = canvas.getContext('2d');

/* === Background image === */
const bgImg = new Image();
bgImg.src = "https://raw.githubusercontent.com/kiaraoptometrypx/trainer_light/main/FCBG.png";
bgImg.onload = () => drawFan();

/* === State === */
let cylBlur = 0.00;
let fogOn = true;
let fogStrength = 0.50;
let angle = 0;

const cylVal = document.getElementById('cylVal');
const fogBtn = document.getElementById('fogBtn');

function updateCylDisplay() {
  let axis = (90 + angle) % 180;
  if (axis === 0) axis = 180;
  cylVal.textContent = `${cylBlur.toFixed(2)} × ${axis.toString().padStart(3,'0')}`;
}

updateCylDisplay();

/* === Controls === */
function toggleFogging() {
  fogOn = !fogOn;
  fogBtn.textContent = fogOn ? 'Lighter' : 'Darker';
  drawFan();
}

function changeCyl(delta) {
  cylBlur = Math.max(0, +(cylBlur + delta).toFixed(2));
  updateCylDisplay();
  drawFan();
}

function rotateFan(delta) {
  angle = (angle + delta + 360) % 360;
  updateCylDisplay();
  drawFan();
}

/* === Draw fan === */
function drawFan() {
  const cw = canvas.width;
  const ch = canvas.height;
  const cx = cw / 2;
  const cy = ch / 2;

  const outerR = cw * 0.290;   // ≈ 160 @ 500
  const innerR = cw * 0.075;   // ≈ 37
  const lineLen = cw * 0.25;   // ≈ 125
  const dotOffset = cw * 0.29; // ≈ 180

  ctx.clearRect(0,0,cw,ch);

  /* Background (center-crop cover) */
  if (bgImg.complete) {
    const iw = bgImg.width;
    const ih = bgImg.height;
    const scale = Math.max(cw / iw, ch / ih);

    const sw = (cw / scale) * 0.93;
    const sh = (ch / scale) * 0.93;
    const sx = (iw - sw) / 2 + 10;
    const sy = (ih - sh) / 2 + 105;

    ctx.drawImage(bgImg, sx, sy, sw, sh, 0, 0, cw, ch);
  }

  /* Outer white circle */
  ctx.beginPath();
  ctx.arc(cx, cy, outerR, 0, Math.PI * 2);
  ctx.fillStyle = 'white';
  ctx.fill();

  ctx.save();
  ctx.translate(cx, cy);
  ctx.rotate(angle * Math.PI / 180);

  const angles = [0,15,30,45,60,75,90,105,120,135,150,165];

  angles.forEach(a => {
    const dist = Math.min(Math.abs(a), Math.abs(a - 180));
    const rawBlur = dist / 30 * cylBlur + (fogOn ? fogStrength : 0);
    const layers = Math.max(1, Math.round(Math.min(rawBlur, 6) * 3));

    for (let i = 0; i < layers; i++) {
      ctx.save();
      ctx.rotate(a * Math.PI / 180);
      ctx.lineWidth = 4;
      ctx.strokeStyle = `rgba(64,64,64,${1/layers})`;
      ctx.beginPath();
      ctx.moveTo(i - layers/2, -lineLen);
      ctx.lineTo(i - layers/2, lineLen);
      ctx.stroke();
      ctx.restore();
    }
  });

/* Red axis markers — opposite ends */
[0, 180].forEach(a => {
  ctx.save();
  ctx.rotate(a * Math.PI / 180);
  ctx.beginPath();
  ctx.arc(0, -dotOffset, 5, 0, Math.PI * 2);
  ctx.fillStyle = 'darkred';
  ctx.fill();
  ctx.restore();
});


  ctx.restore();

  /* Center white circle */
  ctx.beginPath();
  ctx.arc(cx, cy, innerR, 0, Math.PI * 2);
  ctx.fillStyle = 'white';
  ctx.fill();
}

drawFan();
</script>




</body>
</html>
